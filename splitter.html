<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cash Cut</title>
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --card: #111827; /* gray-900 */
        --muted: #94a3b8; /* slate-400 */
        --text: #e5e7eb; /* gray-200 */
        --accent: #22d3ee; /* cyan-400 */
        --ring: rgba(34, 211, 238, 0.35);
        /* Palette for slices */
        --c1: #7c3aed; /* violet */
        --c2: #06b6d4; /* cyan */
        --c3: #f59e0b; /* amber */
        --c4: #10b981; /* emerald */
        --c5: #ef4444; /* red */
        --c6: #3b82f6; /* blue */
        --c7: #f97316; /* orange */
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(
          1200px 800px at 70% -10%,
          #111827 0%,
          var(--bg) 60%
        );
        color: var(--text);
      }
      .wrap {
        max-width: 1100px;
        margin: 40px auto;
        padding: 0 20px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 18px;
      }
      h1 {
        font-size: clamp(20px, 3.5vw, 34px);
        margin: 0;
        letter-spacing: 0.3px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 20px;
        padding: 22px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      .grid {
        display: grid;
        grid-template-columns: 1.2fr 0.9fr;
        gap: 22px;
      }
      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      /* Input */
      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      .controls input[type="number"] {
        appearance: textfield;
        width: 210px;
        padding: 12px 14px;
        font-size: 16px;
        border-radius: 12px;
        background: #0b1220;
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.1);
        outline: none;
        transition: border 0.2s, box-shadow 0.2s;
      }
      .controls input[type="number"]:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 6px var(--ring);
      }
      .btn {
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: #0b1220;
        color: var(--text);
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 600;
        letter-spacing: 0.2px;
        transition: 0.2s;
      }
      .btn:hover {
        transform: translateY(-1px);
        border-color: rgba(255, 255, 255, 0.28);
      }

      /* Pie */
      .pie-wrap {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .pie {
        --g: conic-gradient(
          var(--c1) 0 0,
          var(--c2) 0 0,
          var(--c3) 0 0,
          var(--c4) 0 0,
          var(--c5) 0 0,
          var(--c6) 0 0,
          var(--c7) 0 0
        );
        width: min(360px, 70vw);
        aspect-ratio: 1/1;
        border-radius: 50%;
        background: var(--g);
        position: relative;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35),
          inset 0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .pie::after {
        /* donut hole */
        content: "";
        position: absolute;
        inset: 8%;
        background: var(--card);
        border-radius: 50%;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.06);
      }
      .total {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        text-align: center;
        z-index: 2;
        font-size: clamp(18px, 2.5vw, 22px);
        color: var(--muted);
      }
      .total strong {
        display: block;
        font-size: clamp(22px, 3vw, 28px);
        color: var(--text);
      }

      /* Legend & table */
      .legend {
        display: grid;
        grid-template-columns: repeat(2, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 18px;
      }
      @media (max-width: 500px) {
        .legend {
          grid-template-columns: 1fr;
        }
      }
      .legend .row {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        background: #0b1220;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .swatch {
        width: 14px;
        height: 14px;
        border-radius: 4px;
        flex: 0 0 auto;
      }
      .row .label {
        font-weight: 600;
      }
      .row .value {
        margin-left: auto;
        color: var(--muted);
      }

      table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 8px;
        margin-top: 10px;
      }
      th,
      td {
        padding: 10px 12px;
        text-align: left;
      }
      thead th {
        font-size: 13px;
        color: var(--muted);
        font-weight: 700;
      }
      tbody tr {
        background: #0b1220;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      tbody tr td:first-child {
        border-top-left-radius: 10px;
        border-bottom-left-radius: 10px;
      }
      tbody tr td:last-child {
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
      }
      tfoot td {
        color: var(--muted);
      }
      .mono {
        font-variant-numeric: tabular-nums;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
      }
      .subtle {
        color: var(--muted);
      }
      .note {
        margin-top: 12px;
        color: var(--muted);
        font-size: 14px;
      }
      .table-input {
        width: 110px;
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: #0b1220;
        color: var(--text);
        outline: none;
      }
      .table-input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px var(--ring);
      }
      .neg {
        color: #ef4444;
      } /* red for negative remaining */
      .pos {
        color: #94d3a2;
      } /* soft green for positive */
      /* Tooltip for pie hover */
      .tooltip {
        position: absolute;
        background: #0b1220;
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: var(--text);
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 13px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.15s ease;
        white-space: nowrap;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>
          Cash Cut ðŸ’¸
        </h1>
      </header>

      <section class="card">
        <div class="controls" aria-label="Controls">
          <label for="amount" class="subtle">Enter any amount</label>
          <input id="amount" type="number" min="0" step="0.01" value="100" />
          <button class="btn" id="copy">Copy breakdown</button>
        </div>

        <div class="grid" style="margin-top: 18px">
          <div class="pie-wrap">
            <div class="pie" id="pie">
              <div class="total">
                <span>Total</span>
                <strong class="mono" id="totalLabel">100</strong>
              </div>
              <div id="tooltip" class="tooltip"></div>
            </div>
          </div>
          <div>
            <table>
              <thead>
                <tr>
                  <th>Category</th>
                  <th class="mono">Percent</th>
                  <th class="mono">Amount</th>
                  <th class="mono">Spent</th>
                  <th class="mono">Remaining</th>
                </tr>
              </thead>
              <tbody id="rows"></tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td class="mono">100%</td>
                  <td class="mono" id="sum">0</td>
                  <td class="mono" id="sumSpent">0</td>
                  <td class="mono" id="sumRemain">0</td>
                </tr>
              </tfoot>
            </table>
            <div class="legend" id="legend" aria-label="Legend"></div>
            <p class="note">
              Rounding: to avoid penny/cent drift, the last slice is adjusted so
              the parts sum exactly to the total.
            </p>
          </div>
        </div>
      </section>
    </div>

    <script>
      // Percent configuration (must sum to 100)
      const PERCENTS = [10, 5, 4, 1, 30, 30, 20];
      const COLORS = [
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c1")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c2")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c3")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c4")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c5")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c6")
          .trim(),
        getComputedStyle(document.documentElement)
          .getPropertyValue("--c7")
          .trim(),
      ];

      const NAMES = [
        "Tithe",
        "Offering",
        "Giving",
        "Dues",
        "Needs",
        "Wants",
        "Savings",
      ];

      function label(i) {
        return NAMES[i] && NAMES[i].trim() ? NAMES[i].trim() : `Slice ${i + 1}`;
      }
      // For hover calculations
      let LAST_PARTS = []; // set each time you render
      const CUM = (() => {
        // cumulative % ends: [10,15,19,20,50,80,100]
        let s = 0;
        return PERCENTS.map((p) => (s += p));
      })();
      function sliceFromAngle(angleDeg) {
        // conic-gradient is clockwise from 0Â° (3 o'clock).
        const cw = (360 - angleDeg) % 360; // convert CCW -> CW
        const pct = cw / 3.6; // degrees -> percent of circle
        for (let i = 0; i < CUM.length; i++) {
          if (pct <= CUM[i] + 1e-9) return i;
        }
        return -1;
      }

      // Track user-entered spend per category (persist between edits)
      let SPENT = Array(PERCENTS.length).fill(0);

      const $amount = document.getElementById("amount");
      const $rows = document.getElementById("rows");
      const $sum = document.getElementById("sum");
      const $pie = document.getElementById("pie");
      const $legend = document.getElementById("legend");
      const $totalLabel = document.getElementById("totalLabel");
      const $copy = document.getElementById("copy");
      const $tooltip = document.getElementById("tooltip");

      function format(n) {
        const num = Number(n);
        if (!Number.isFinite(num)) return "0";
        const fixed = Math.round(num * 100) / 100; // 2dp rounding
        const s = fixed.toFixed(2); // "12.30"
        const [i, d] = s.split(".");
        const int = i.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return d === "00" ? int : `${int}.${d}`;
      }

      function computeParts(total) {
        const parts = [];
        let running = 0;
        for (let i = 0; i < PERCENTS.length; i++) {
          if (i < PERCENTS.length - 1) {
            const raw = total * (PERCENTS[i] / 100);
            const amt = Math.round(raw * 100) / 100; // 2dp
            parts.push(amt);
            running += amt;
          } else {
            // Last slice gets the remainder to ensure exact sum
            const last = Math.round((total - running) * 100) / 100;
            parts.push(last);
          }
        }
        return parts;
      }

      function update() {
        const total = Math.max(0, parseFloat($amount.value || "0"));
        $totalLabel.textContent = format(total);

        const parts = computeParts(total);
        LAST_PARTS = parts; // <-- so hover tooltips have current amounts

        // build table rows
        $rows.innerHTML = "";
        let sum = 0;

        parts.forEach((amt, i) => {
          sum += amt;
          const tr = document.createElement("tr");
          const remaining = Math.round((amt - (SPENT[i] || 0)) * 100) / 100;
          const remClass = remaining < 0 ? "neg mono" : "mono pos";

          tr.innerHTML = `
      <td>${label(i)}</td>
      <td class="mono">${PERCENTS[i]}%</td>
      <td class="mono">${format(amt)}</td>
      <td>
        <input class="table-input mono" type="number" step="0.01" min="0"
               value="${SPENT[i] || 0}" data-index="${i}" />
      </td>
      <td class="${remClass}">${format(remaining)}</td>
    `;
          tr.style.borderLeft = `6px solid ${COLORS[i]}`;
          $rows.appendChild(tr);
        });

        // totals
        $sum.textContent = format(sum);
        const totalSpent = SPENT.reduce((a, b) => a + (parseFloat(b) || 0), 0);
        const totalRemain = Math.round((sum - totalSpent) * 100) / 100;
        document.getElementById("sumSpent").textContent = format(totalSpent);
        document.getElementById("sumRemain").textContent = format(totalRemain);

        // donut gradient
        let start = 0;
        const stops = PERCENTS.map((pct, i) => {
          const end = start + pct;
          const stop = `${COLORS[i]} ${start}% ${end}%`;
          start = end;
          return stop;
        });
        $pie.style.setProperty("--g", `conic-gradient(${stops.join(",")})`);

        // legend
        $legend.innerHTML = "";
        PERCENTS.forEach((pct, i) => {
          const row = document.createElement("div");
          row.className = "row";
          row.innerHTML = `
      <span class="swatch" style="background:${COLORS[i]}"></span>
      <span class="label">${label(i)} â€” ${pct}%</span>
      <span class="value mono">${format(parts[i])}</span>
    `;

          $legend.appendChild(row);
        });

        // Attach input handlers to all 'Spent' inputs (AFTER rows exist)
        $rows.querySelectorAll("input.table-input").forEach((inp) => {
          inp.addEventListener("input", (e) => {
            const idx = parseInt(e.target.dataset.index, 10);
            const val = Math.max(0, parseFloat(e.target.value || "0"));
            SPENT[idx] = val;
            update(); // re-render Remaining + totals
          });
        });
      }

      // Fixed mousemove event listener
      $pie.addEventListener("mousemove", (e) => {
        const rect = $pie.getBoundingClientRect();
        const cx = rect.width / 2,
          cy = rect.height / 2;
        const x = e.clientX - rect.left - cx;
        const y = e.clientY - rect.top - cy;

        const r = Math.sqrt(x * x + y * y);
        const angleCCW = (Math.atan2(y, x) * 180) / Math.PI; // -180..180
        const angleDeg = angleCCW < 0 ? angleCCW + 360 : angleCCW;

        // Ring bounds: ::after inset 8% makes inner diameter â‰ˆ 84% => innerR â‰ˆ 0.42*size
        const size = rect.width;
        const innerR = size * 0.42;
        const outerR = size * 0.5;

        if (r < innerR || r > outerR) {
          $tooltip.style.opacity = 0;
          return;
        }

        const idx = sliceFromAngle(angleDeg);
        if (idx < 0 || idx >= LAST_PARTS.length) {
          $tooltip.style.opacity = 0;
          return;
        }

        // Fix: Ensure we have valid data before showing tooltip
        if (!LAST_PARTS || LAST_PARTS.length === 0) {
          $tooltip.style.opacity = 0;
          return;
        }

        const amt = LAST_PARTS[idx];
        // Fix: Check for valid number
        if (!Number.isFinite(amt)) {
          $tooltip.style.opacity = 0;
          return;
        }

        $tooltip.textContent = `${label(idx)} â€¢ ${PERCENTS[idx]}% â€¢ ${format(amt)}`;
        $tooltip.style.left = e.clientX - rect.left + 10 + "px";
        $tooltip.style.top = e.clientY - rect.top - 10 + "px";
        $tooltip.style.opacity = 1;
      });

      $pie.addEventListener("mouseleave", () => {
        $tooltip.style.opacity = 0;
      });

      $amount.addEventListener("input", update);
      $amount.addEventListener("change", update);

      $copy.addEventListener("click", () => {
        const total = Math.max(0, parseFloat($amount.value || "0"));
        const parts = computeParts(total);

        const lines = parts.map((v, i) => {
          const spent = SPENT[i] || 0;
          const rem = Math.round((v - spent) * 100) / 100;
          return `${label(i)} (${PERCENTS[i]}%): ${format(v)} | Spent: ${format(
            spent
          )} | Remaining: ${format(rem)}`;
        });
        const text = `Total: ${format(total)}\n` + lines.join("\n");

        navigator.clipboard.writeText(text).then(() => {
          $copy.textContent = "Copied!";
          setTimeout(() => {
            $copy.textContent = "Copy breakdown";
          }, 1200);
        });
      });

      update();
    </script>
  </body>
</html>